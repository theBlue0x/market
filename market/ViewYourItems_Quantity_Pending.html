<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Blue0x Decentralized Marketplace">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>Blue0x | MARKET</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-reset.css" rel="stylesheet">
  <link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/style.min.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />
  <link href="css/spinner.css" rel="stylesheet">
  <link href="assets/fancybox/jquery.fancybox.css" rel="stylesheet" />
  <link href="css/gallery.css" rel="stylesheet" />
  <script>
  // Redirect the user if the user is not already logged in
  function checkLogin() {
    var loginStatus = sessionStorage.getItem("loginStatus");
    if (loginStatus == 'notloggedin') {
      localStorage.setItem("lastpage", "ViewYourItems_Quantity_Pending.html"); // set the page for the Continue button on Login Notice page
      var fmlang = localStorage.getItem("fmlang");
      window.location.href = 'login.html' + '?setLng=' + fmlang;
    }};
  </script>

  <script>
  function rejectPurchase() {
    var secretPhraseCheck = document.getElementById('secretPhrase').value; // To check that it's not blank
    var listingid = (getQueryVariable("itemid"));
    var buyingID = sessionStorage.getItem("buyingID");

    if (secretPhraseCheck == "") {
      var translatedSecretPhraseErrorMessage = $.t("error_secret_phrase"); // Get localized error message
      // Display localized error message
      document.getElementById("secretPhraseErrorMessage").innerHTML = "<p class=\"validation_message\">" + translatedSecretPhraseErrorMessage + "</p>";
    } else {
      // Secret phrase field is not empty
      // Clear the error field next to the Secret Phrase field    
      document.getElementById("secretPhraseErrorMessage").innerHTML = "";

      // Disable the reject purchase button while NxtPass does its work
      document.getElementById("rejectButton").disabled = true;
      document.getElementById("finalizeButton").disabled = true;
      document.getElementById("rejectButton").innerHTML = "<i class=\"fa fa-refresh fa-spin\"></i> &nbsp;Processing...";

      $.post(Constants.apiUrl, {
          requestType: 'rejectPurchase',
          listing_id: listingid,
          messageToBuyer: $('#messageToBuyer').val(),
          buying_id: buyingID,
          usersSecretPhrase: $('#secretPhrase').val()
        },
        function(result) {

          var reject_purchase_status = result.query_status;
          if (reject_purchase_status == 'good') {
            var translatedSuccessRejected = $.t("reject_sale_success_message");
            document.getElementById("successMessage").innerHTML = translatedSuccessRejected;
          } else {
            // Display failure message  
            var translatedFailureRejected = $.t("reject_sale_failure_message");
            document.getElementById("successMessage").innerHTML = translatedFailureRejected;
          }
        }, "json"); // Specifies JSON as the expected result
    } // End else for passing secret phrase error check
  };
  </script>
  <!--End rejectPurchase function-->

  <script>
  function finalizePurchase() {
    var secretPhraseCheck = document.getElementById('secretPhrase').value; // To check that it's not blank
    var listingid = (getQueryVariable("itemid"));
    var buyingID = sessionStorage.getItem("buyingID");

    if (secretPhraseCheck == "") {
      var translatedSecretPhraseErrorMessage = $.t("error_secret_phrase"); // Get localized error message
      // Display localized error message
      document.getElementById("secretPhraseErrorMessage").innerHTML = "<p class=\"validation_message\">" + translatedSecretPhraseErrorMessage + "</p>";
    } else {
      // Secret phrase field is not empty
      // Clear the error field next to the Secret Phrase field    
      document.getElementById("secretPhraseErrorMessage").innerHTML = "";

      // Disable the finalize purchase button while NxtPass does its work
      document.getElementById("finalizeButton").disabled = true;
      document.getElementById("rejectButton").disabled = true;
      document.getElementById("finalizeButton").innerHTML = "<i class=\"fa fa-refresh fa-spin\"></i> &nbsp;Processing...";

      $.post(Constants.apiUrl, {
          requestType: 'finalizePurchase',
          listing_id: listingid,
          messageToBuyer: $('#messageToBuyer').val(),
          buying_id: buyingID,
          usersSecretPhrase: $('#secretPhrase').val()
        },
        function(result) {

          var finalize_purchase_status = result.query_status;
          if (finalize_purchase_status == 'good') {
            // Display success message  
            var translatedSuccessFinalized = $.t("success_finalize_purchase");
            document.getElementById("successMessage").innerHTML = translatedSuccessFinalized;
          } else {
            // Display failure message  
            var translatedFailureFinalized = $.t("failure_finalize_purchase");
            document.getElementById("successMessage").innerHTML = translatedFailureFinalized;
          }
        }, "json"); // Specifies JSON as the expected result
    } // End else for passing secret phrase error check
  };
  </script>
  <!--End finalizePurchase function-->
</head>
<body class="full-width" onload="setAccountNumber(); checkLogin(); setLanguage();">
  <section id="container">
    <script type="text/javascript" src="js/menu.js"></script>
    <section id="main-content">
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">
              <header class="panel-heading">
              </header>
              <span id="pageHeader"></span>
              <div class="panel-body">
                <div class="form-group">
                  <span id="successMessage">
                    <aside class="profile-nav alt green-border">
                      <section class="panel">
                        <div class="user-heading alt green-bg">
                          <span id="top_image"><a href="#"><img alt="" src="img/Box-icon.png"></a></span>
                          <h1 id="title">No Item Title</h1>
                          <p><span data-i18n="item_id">Item ID</span>: <span id="itemID"></span></p>
                          <p><span data-i18n="buyer_id">Buyer ID</span>: <span id="buyerID"></span></p>
                          <p><span data-i18n="status">Status</span>: <span id="status"></span></p>
                          <br />
                          <hr>
                          <p><i class="fa fa-tasks"></i> <span data-i18n="category">Category</span>: <span id="category"></span></a>
                          </p>
                          <p><i class="fa fa-tags"></i> <span data-i18n="tags">Tags</span>: <span id="tags"></span></a>
                          </p>
                          <p><i class="fa fa-clock-o"></i> <span data-i18n="expiration">Expiration</span>: <span id="expiration"></span></a>
                          </p>
                          <p><i class="fa fa-clock-o"></i> <span data-i18n="sold_date">Sold</span>: <span id="sold"></span></a>
                          </p>
                          <hr>
                          <p><i class="fa fa-signal"></i> <span data-i18n="quantity_purchased">Quantity Purchased</span>: <span id="quantity_purchased"></span></p>
                          <p><i class="fa fa-money"></i> <span data-i18n="amount_received">Amount Received</span>: <span id="price"></span></p>
                          <p><i class="fa fa-truck"></i> <span data-i18n="shipping_method">Shipping Method</span>: <span id="shippingMethod"></span></p>
                          <p><i class="fa fa-home"></i> <span data-i18n="shipping_address">Shipping Address</span>: <span id="shippingAddress"></span></p>
                          <p><i class="fa fa-bullhorn"></i> <span data-i18n="message_from_buyer">Message from Buyer</span>: <span id="message"></span></p>
                          <hr>
                          <p><span data-i18n="description">Description</span>:
                            <br /><span id="description"></span></p>
                        </div>
                      </section>
                    </aside>
                    <hr>
                    <div id="secretPhraseSection">
                      <!--Secret Phrase required to display buyer's private info-->
                      <div class="form-group">
                        <label for="secretPhrase"><span data-i18n="secret_phrase">Secret Phrase</span></label>
                        <div class="iconic-input">
                          <i class="fa fa-key"></i>
                          <input type="password" class="form-control" data-i18n="[placeholder]placeholder_required" id="secretPhrase">
                          <div id="secretPhraseErrorMessage"></div>
                        </div>
                      </div>
                    </div>
                    <!--End of secretPhraseSection div-->
                    <div class="form-group">
                      <a class="btn btn-info" id="finalizeButton" onclick="displayPrivateInfo()" type="button">
                            Reveal Hidden Information</a>
                    </div>
                    <hr>
                    <div id="messageSection">
                      <!--Encrypted message to buyer-->
                      <div class="form-group">
                        <label for="messageToBuyer"><span data-i18n="message_to_buyer">Message to Buyer</span></label>
                        <div class="iconic-input">
                          <i class="fa fa-bullhorn"></i>
                          <input type="text" class="form-control" data-i18n="[placeholder]placeholder_message_to_buyer" id="messageToBuyer">
                        </div>
                      </div>
                    </div>
                    <!--End of messageSection div-->
                    <div class="form-group">
                      <a class="btn btn-default" id="finalizeButton" onclick="finalizePurchase()" type="button">
                        <span data-i18n="button_finalize_purchase">Finalize Sale</span></a>
                      <a class="btn btn-danger" id="rejectButton" onclick="rejectPurchase()" type="button">
                        <span data-i18n="button_reject_purchase">Reject Sale</span></a>
                    </div>
                  </span>
                  <!--end successMessage span-->
                </div>
              </div>
            </section>
          </div>
          <div id="searchResults">
          </div>
        </div>
      </section>
    </section>
  </section>
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.dcjqaccordion.2.7.min.js"></script>
  <script src="js/bootstrap-hover-dropdown.min.js"></script>
  <script src="js/respond.min.js"></script>
  <script src="assets/fancybox/jquery.fancybox.js"></script>
  <script src="js/validator.min.js"></script>
  <script type="text/javascript">
  $(function() {
    jQuery(".fancybox").fancybox();
  });
  </script>
  <script src="js/constants.js"></script>
  <script src="js/freemarket_scripts.js"></script>
  <script src="js/common-scripts.js"></script>
  <script src="js/i18next.min.js"></script>
  <script src="js/freemarket_localization_scripts.js"></script>
  <script src="js/moment.min.js"></script>
  <script src="js/pending_sales_notice.js"></script>
</body>
</html>