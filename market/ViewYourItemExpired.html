<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Blue0x Decentralized Marketplace">
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>Blue0x | MARKET</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-reset.css" rel="stylesheet">
  <link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/style.min.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />
  <link href="css/spinner.css" rel="stylesheet">
  <link href="assets/fancybox/jquery.fancybox.css" rel="stylesheet" />
  <link href="css/gallery.css" rel="stylesheet" />
  <script>
  // Redirect the user if the user is not already logged in
  function checkLogin() {
    var loginStatus = sessionStorage.getItem("loginStatus");
    if (loginStatus == 'notloggedin') {
      localStorage.setItem("lastpage", "ViewYourItemExpired.html"); // set the page for the Continue button on Login Notice page
      var fmlang = localStorage.getItem("fmlang");
      window.location.href = 'login.html' + '?setLng=' + fmlang;
    }};
  </script>
  <script>
  // Set Relist Item text on page load
  function setButtonText() {
    // Translate the button text
    var translatedRelistButtonText = $.t("button_relist_item");
    document.getElementById("relistButtonText").innerHTML = translatedRelistButtonText;
  };
  </script>
  <script>
  // Set listing fee text on change of listing duration
  function setListingFeeText() {
    // Translate the listing text
    var translatedListingFeeText = $.t("listing_fee_notice");
    // The duration affects the listing fee.
    var radios = document.getElementsByName('durationOption');
    expireTimeValue = Constants.listingDurationDefault;
    console.log("The initial expireTimeValue has been set to " + expireTimeValue);
    for (var i = 0, length = radios.length; i < length; i++) {
      if (radios[i].checked) {
        var duration = radios[i].value;
        if (duration == "4weeks") { // 4 week duration is selected
          var listingFee = "0"; // The 4 week listing fee
          // also set duration value
          expireTimeValue = Constants.listingDurationExtended; // The 4 week duration
          console.log("The duration is 4 weeks and the expireTimeValue has been set to " + expireTimeValue);
        } else { // otherwise, 2 week duration is selected
          var listingFee = "0"; // The 2 week listing fee
          // also set duration value
          expireTimeValue = Constants.listingDurationDefault; // The 2 week duration
          console.log("The duration is 2 weeks and the expireTimeValue has been set to " + expireTimeValue);
        }
      }
    }

    document.getElementById("listingFeeNotice").innerHTML = "<p class=\"text-muted\">" + translatedListingFeeText + listingFee + ".</p>";
  };
  </script>

  <script>
  function listAgain() {
    var secretPhraseCheck = document.getElementById('secretPhrase').value;

    if (secretPhraseCheck == "") {
      var translatedSecretPhraseErrorMessage = $.t("error_secret_phrase");
      document.getElementById("secretPhraseErrorMessage").innerHTML = "<p class=\"validation_message\">" + translatedSecretPhraseErrorMessage + "</p>";
    } else {
      // Clear the secret phrase error message if there is one
      document.getElementById("secretPhraseErrorMessage").innerHTML = "";
      // Get fields for relisting item
      var relistTitle = sessionStorage.getItem("relistTitle");
      var relistPrice = sessionStorage.getItem("relistPrice");
      var relistCurrency = sessionStorage.getItem("relistCurrency");
      var relistQuantity = sessionStorage.getItem("availableQuantity");
      var relistCategory1 = sessionStorage.getItem("relistCategory1");
      var relistDescription = sessionStorage.getItem("relistDescription");
      var relistMainImageURL = sessionStorage.getItem("relistMainImageURL");
      var relistTag1 = sessionStorage.getItem("relistTag1");
      var relistTag2 = sessionStorage.getItem("relistTag2");
      var relistTag3 = sessionStorage.getItem("relistTag3");
      var relistAdditional_image_1_URL = sessionStorage.getItem("relistAdditional_image_1_URL");
      var relistAdditional_image_2_URL = sessionStorage.getItem("relistAdditional_image_2_URL");
      var relistAdditional_image_3_URL = sessionStorage.getItem("relistAdditional_image_3_URL");
      var relistShippingMethod1 = sessionStorage.getItem("relistShippingMethod1");
      var relistShippingMethod2 = sessionStorage.getItem("relistShippingMethod2");
      var relistShippingMethod3 = sessionStorage.getItem("relistShippingMethod3");
      var relistShippingCost1 = sessionStorage.getItem("relistShippingCost1");
      var relistShippingCost2 = sessionStorage.getItem("relistShippingCost2");
      var relistShippingCost3 = sessionStorage.getItem("relistShippingCost3");

      // Disable the button while NxtPass does its work
      document.getElementById("relistButtonSection").innerHTML = "<button type=\"button\" id=\"buyButton\" class=\"btn btn-default\"><i class=\"fa fa-refresh fa-spin\"></i> &nbsp;Processing...</button>";

      $.post(Constants.apiUrl, {
          requestType: 'listItem',
          item_title: relistTitle,
          category1: relistCategory1,
          item_tag1: relistTag1,
          item_tag2: relistTag2,
          item_tag3: relistTag3,
          quantity: relistQuantity,
          currency: relistCurrency,
          price: relistPrice,
          item_description: relistDescription,
          main_image_url: relistMainImageURL,
          additional_image_1_URL: relistAdditional_image_1_URL,
          additional_image_2_URL: relistAdditional_image_2_URL,
          additional_image_3_URL: relistAdditional_image_3_URL,
          shippingMethod1: relistShippingMethod1,
          shippingCost1: relistShippingCost1,
          shippingMethod2: relistShippingMethod2,
          shippingCost2: relistShippingCost2,
          shippingMethod3: relistShippingMethod3,
          shippingCost3: relistShippingCost3,
          expireTime: expireTimeValue,
          usersSecretPhrase: $('#secretPhrase').val()
        },
        function(result) {

          var relisting_response = result.query_status;
          if (relisting_response == 'good') {
            var listingID = result.listing_id;
            var fmlang = localStorage.getItem("fmlang");
            document.getElementById("successMessage").innerHTML = "<br />You have relisted your item as item number: <a href=\"ViewYourItemSingle.html?setLng=" + fmlang + "&itemid=" + listingID + "\">" + listingID + "</a>. NOTE: Your item may take a few minutes to appear.<br />";
          } else {
            document.getElementById("successMessage").innerHTML = " Result: FAILURE to relist item.";
          }
        }, "json"); // Specifies JSON as the expected result
    } // End of else after secret phrase check
  };
  </script>
</head>

<body class="full-width" onload="setAccountNumber(); checkLogin(); setLanguage(); setListingFeeText();">
  <section id="container">
    <script type="text/javascript" src="js/menu.js">
    </script>
    <section id="main-content">
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">
              <header class="panel-heading">
                <span id="pageHeader"></span>
              </header>
              <div class="panel-body">
                <div class="form-group">
                  <span id="successMessage">
                    <aside class="profile-nav alt green-border">
                      <section class="panel">
                        <div class="user-heading alt green-bg">
                          <span id="top_image"><a href="#"><img alt="" src="img/Box-icon.png"></a></span>

                          <h1 id="title">No Item Title</h1>
                          <p><span data-i18n="item_id">Item ID</span>: <span id="itemID"></span></p>
                          <br />
                          <hr>
                          <p><i class="fa fa-tasks"></i> <span data-i18n="categories">Category</span>: <span id="category"></span></a>
                          </p>
                          <p><i class="fa fa-tags"></i> <span data-i18n="tags">Tags</span>: <span id="tags"></span></a>
                          </p>
                          <p><i class="fa fa-clock-o"></i> <span data-i18n="expiration">Expires</span>: <span id="expiration"></span></a>
                          </p>
                          <p><i class="fa fa-signal"></i> <span data-i18n="quantity">Quantity</span>: <span id="quantity"></span></p>
                          <p><i class="fa fa-money"></i> <span data-i18n="price">Price</span>: <span id="price"></span></a>
                          </p>
                          <hr>
                          <p><span data-i18n="description">Description</span>:
                            <br /><span id="description"></span></p>
                        </div>
                      </section>
                    </aside>
                    <div id="extra_images_section"></div>
                    <label><span data-i18n="header_listing_duration">Listing Duration</span></label>
                    <form class="form-horizontal tasi-form" role="form">
                      <div class="form-group">
                        <div id="listing_duration_section">
                          <div class="input-group m-bot15">
                            <div class="col-lg-12">
                              <div class="radio">
                                <label>
                                  <input type="radio" name="durationOption" id="durationOption" value="2weeks" checked onclick="setListingFeeText()">
                                  <span data-i18n="duration_2_weeks">2 Weeks (listing fee: 0 NXT)</span>
                                </label>
                              </div>
                              <div class="radio">
                                <label>
                                  <input type="radio" name="durationOption" id="durationOption" value="4weeks" onclick="setListingFeeText()">
                                  <span data-i18n="duration_4_weeks">4 Weeks (listing fee: 0 NXT)</span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div id="listingDurationErrorMessage"></div>
                      </div>
                    </form>
                    <hr>
                    <div class="form-group">
                      <label for="secretPhrase"><span data-i18n="secret_phrase">Secret Phrase</span></label>
                      <div class="iconic-input">
                        <i class="fa fa-key"></i>
                        <input type="password" class="form-control" id="secretPhrase" data-i18n="[placeholder]placeholder_required">
                        <div id="secretPhraseErrorMessage"></div>
                      </div>
                    </div>
                    <div id="relistButtonSection">
                      <button type="button" id="relistButton" class="btn btn-default" onclick="listAgain();">
                      	<div id="relistButtonText"></div>
                      </button>
                    </div>
                    <br />
                    <div id="listingFeeNotice">
                      <p class="text-muted">The fee to list this item is NXT 0.</p>
                    </div>
                  </span>
                </div>
              </div>
            </section>
          </div>
          <div id="searchResults">
          </div>
        </div>
      </section>
    </section>   
  </section>
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.dcjqaccordion.2.7.min.js"></script>
  <script src="js/bootstrap-hover-dropdown.min.js"></script>
  <script src="js/respond.min.js"></script>
  <script src="assets/fancybox/jquery.fancybox.js"></script>
  <script src="js/validator.min.js"></script>
  <script type="text/javascript">
  $(function() {
    jQuery(".fancybox").fancybox();
  });
  </script>
  <script src="js/constants.js"></script>
  <script src="js/freemarket_scripts.js"></script>
  <script src="js/common-scripts.js"></script>
  <script src="js/i18next.min.js"></script>
  <script src="js/freemarket_localization_scripts.js"></script>
  <script src="js/moment.min.js"></script>
  <script src="js/pending_sales_notice.js"></script>
</body>
</html>